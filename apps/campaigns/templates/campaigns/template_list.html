{% extends "core/base.html" %}
{% block title %}Templates{% endblock %}

{% block content %}

<div style="display:flex; justify-content:space-between; align-items:center;">
    <h1>Template List</h1>

    <a class="btn" href="{% url 'campaigns:create_template' %}">
        + Create new template
    </a>
</div>

<br>

{% if public_templates or user_templates %}
    <!-- {% with total=public_templates|length %}
        {% with total=total|add:user_templates|length %}
            <p class="text-center">
                {{ total }} templates available.
            </p>
        {% endwith %}
    {% endwith %} -->

    <table class="table plasmid-table">
        <thead>
            <tr>
                <th style="width:40px;"></th>
                <th>Name</th>
                <th>XLSX</th>
                <th>Visibility</th>
                <th>Type</th>
                <th>Restriction enzyme</th>
                <th>Separator</th>
                <th>Created</th>
                <th>Owner</th>
            </tr>
        </thead>

        <tbody>
            {# ===== PUBLIC TEMPLATES ===== #}
            {% for template in public_templates %}
                <tr>
                    <td></td>

                    <td class="template-name">{{ template.name }}</td>

                    <td>
                        <a class="download-link"
                           href="{% url 'campaigns:download_public_template' template.id %}?format=xlsx">
                            XLSX
                        </a>
                    </td>

                    <td class="template-meta">
                        <span class="badge bg-success">Public</span>
                    </td>

                    <td class="template-meta">{{ template.template_type }}</td>
                    <td class="template-meta">{{ template.restriction_enzyme|default_if_none:"" }}</td>
                    <td class="template-meta">{{ template.separator|default_if_none:"" }}</td>
                    <td class="template-meta">{{ template.created_at|date:"Y-m-d H:i" }}</td>
                    <td class="template-meta">{{ template.owner.username|default_if_none:"" }}</td>
                </tr>
            {% endfor %}

            {# ===== USER TEMPLATES ===== #}
            {% for template in user_templates %}
                <tr>
                    <td>
                        <form method="post"
                              action="{% url 'campaigns:delete_template' template.id %}"
                              onsubmit="return confirm('Delete this template?');">
                            {% csrf_token %}
                            <button type="submit" class="delete-icon">üóëÔ∏è</button>
                        </form>
                    </td>

                    <td class="template-name">{{ template.name }}</td>

                    <td>
                        <a class="download-link"
                           href="{% url 'campaigns:download_template' template.id %}?format=xlsx">
                            XLSX
                        </a>
                    </td>

                    <td class="template-meta">
                        <span class="badge bg-secondary">Private</span>
                    </td>

                    <td class="template-meta">{{ template.template_type }}</td>
                    <td class="template-meta">{{ template.restriction_enzyme|default_if_none:"" }}</td>
                    <td class="template-meta">{{ template.separator|default_if_none:"" }}</td>
                    <td class="template-meta">{{ template.created_at|date:"Y-m-d H:i" }}</td>
                    <td class="template-meta">{{ template.owner.username|default_if_none:"" }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

{% else %}
    <p class="text-center text-muted">No templates found</p>
{% endif %}

<style>
.plasmid-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    font-size: 15px;
}

.plasmid-table thead tr {
    background-color: var(--primary);
    color: #fff;
}

.plasmid-table th,
.plasmid-table td {
    padding: 14px 12px;
    border-bottom: 1px solid var(--border);
    vertical-align: middle;
    text-align: center;
}

/* Alternating rows */
.plasmid-table tbody tr:nth-child(odd) {
    background-color: var(--card);
}

.plasmid-table tbody tr:nth-child(even) {
    background-color: var(--primary-soft);
}

/* UNIFORM hover on entire row */
.plasmid-table tbody tr:hover {
    background-color: var(--primary);
    color: #fff;
}

.plasmid-table tbody tr:hover a,
.plasmid-table tbody tr:hover span,
.plasmid-table tbody tr:hover button {
    color: #fff;
}

/* Name emphasis */
.template-name {
    font-size: 16px;
    font-weight: 600;
}

/* Less prominent metadata */
.template-meta {
    font-size: 13px;
    opacity: 0.8;
}

/* Download links */
.download-link {
    font-weight: 600;
    text-decoration: none;
    color: inherit;
}

.download-link:hover {
    text-decoration: underline;
}

/* Delete button */
.delete-icon {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 18px;
}

.delete-icon:hover {
    color: red;
}
</style>

{% endblock %}
