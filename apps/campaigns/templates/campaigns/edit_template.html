{% extends "core/base.html" %}
{% block title %}Edit Template{% endblock %}

{% block content %}

<div style="display:flex; justify-content:space-between; align-items:center;">
    <h1>Edit template</h1>
    <a class="btn" href="{% url 'campaigns:template_list' %}">
        Back to template list
    </a>
</div>

<br>

<form method="post">
    {% csrf_token %}
    {{ form.non_field_errors }}

    <!-- ================= TEMPLATE NAME ================= -->
    <div class="card" style="padding:16px; margin-bottom:12px;">
        <div class="form-row">
            <div class="label-strong">
                <strong>{{ form.name.label }}</strong><br><br>
            </div>
            {{ form.name }}
            {{ form.name.errors }}
        </div>
    </div>

    <!-- ================= TEMPLATE TYPE ================= -->
    <div class="card" style="padding:16px; margin-bottom:12px;">
        <div class="form-row">
            <div class="label-strong">
                <strong>{{ form.template_type.label }}</strong><br><br>
            </div>

            <div class="radio-group">
                {% for radio in form.template_type %}
                    <label class="radio-item">
                        {{ radio.tag }}
                        <span>{{ radio.choice_label }}</span>
                    </label>
                {% endfor %}
            </div>

            <button type="button"
                    id="type-info"
                    style="margin-top:8px;">
                ℹ️
            </button>

            <div id="type-info-text"
                 style="display:none; margin-top:8px; background:#f6f6f6; padding:8px; border-radius:4px;">
                <p><strong>Simple</strong>: inputs don't have a type.</p>
                <p><strong>Typed</strong>: each input has a type.</p>
            </div>

            {{ form.template_type.errors }}
        </div>
    </div>

    <div class="card" style="padding:16px; margin-bottom:12px;">
        <div class="form-row">
            <div class="label-strong">
                <strong>{{ form.restriction_enzyme.label }}</strong><br><br>
            </div>
            {{ form.restriction_enzyme }}
            {{ form.restriction_enzyme.errors }}
        </div>

        <div class="form-row" id="separator-field">
            <div class="label-strong">
                <strong>{{ form.separator.label }}</strong><br><br>
            </div>
            {{ form.separator }}
            {{ form.separator.errors }}
        </div>
    </div>

    <div style="margin-top: 32px;">
        <button type="submit" class="btn" style="width: 100%; padding: 16px; font-size: 1.1em;">
            SAVE CHANGES
        </button>
    </div>
</form>

<br>

<!-- ================= XLSX REPLACEMENT ================= -->
<div class="card" style="padding:16px; margin-bottom:12px;">
    <h3>Or replace template using XLSX</h3>
    <p class="text-muted">
        Uploading a new XLSX file will overwrite the current template structure.
    </p>

    <form method="post"
          action="{% url 'campaigns:replace_template_xlsx' template.id %}"
          enctype="multipart/form-data">
        {% csrf_token %}
        <input type="file" name="xlsx" accept=".xlsx" required>
        <br>
        <div style="margin-top: 32px;">
            <button type="submit" class="btn" style="width: 100%; padding: 16px; font-size: 1.1em;">
                UPLOAD NEW TEMPLATE
            </button>
        </div>
    </form>
</div>



<style>
.radio-group {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    width: 100%;
}

.radio-item {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 6px;
}

.radio-item span {
    font-weight: 600;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const infoBtn = document.getElementById('type-info');
    if (infoBtn) {
        infoBtn.addEventListener('click', function () {
            const t = document.getElementById('type-info-text');
            t.style.display = (t.style.display === 'none') ? 'block' : 'none';
        });
    }
});
</script>

{% endblock %}
