{% extends "core/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/publications.css' %}">
{% endblock %}

{% block content %}
<h1 class="page-title">My publication requests</h1>

<div class="card">
  <p class="muted">
    Track the status of your requests. Team resources must be validated by the team cheffe before being reviewed by an administratrice.
  </p>

  <div class="table-wrap">
    <table class="nice-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Target</th>
          <th>Team</th>
          <th>Status</th>
          <th>Next step</th>
          <th>Comment</th>
          <th>Created</th>
        </tr>
      </thead>

      <tbody>
        {% for pub in publications %}
        <tr>
          <td>#{{ pub.id }}</td>

          <td>
            <div><strong>{{ pub.target }}</strong></div>
            <div class="muted">
              {{ pub.target_content_type.app_label }}/{{ pub.target_content_type.model }}
              (id={{ pub.target_object_id }})
            </div>
          </td>

          <td>{{pub.team}}</td>


          <td>
            {% if pub.status == "PENDING_CHEFFE" %}
              <span class="badge pending">Pending (cheffe)</span>
            {% elif pub.status == "PENDING_ADMIN" %}
              <span class="badge pending">Pending (admin)</span>
            {% elif pub.status == "APPROVED" %}
              <span class="badge approved">Approved</span>
            {% elif pub.status == "REJECTED_BY_CHEFFE" %}
              <span class="badge rejected">Rejected (cheffe)</span>
            {% elif pub.status == "REJECTED_BY_ADMIN" %}
              <span class="badge rejected">Rejected (admin)</span>
            {% else %}
              <span class="badge">{{ pub.status }}</span>
            {% endif %}
          </td>

          <td class="muted">
            {% if pub.status == "PENDING_CHEFFE" %}
              Waiting for team cheffe validation
            {% elif pub.status == "PENDING_ADMIN" %}
              Waiting for administratrice review
            {% elif pub.status == "APPROVED" %}
              Published
            {% elif pub.status == "REJECTED_BY_CHEFFE" or pub.status == "REJECTED_BY_ADMIN" %}
              Closed
            {% else %}
              —
            {% endif %}
          </td>

          <td>
            {% if pub.status == "REJECTED_BY_CHEFFE" %}
              {{ pub.cheffe_review_comment|default:"—" }}
            {% elif pub.status == "REJECTED_BY_ADMIN" %}
              {{ pub.admin_review_comment|default:"—" }}
            {% else %}
              —
            {% endif %}
          </td>

          <td>{{ pub.created_at|date:"Y-m-d H:i" }}</td>
        </tr>

        {% empty %}
        <tr>
          <td colspan="6" class="empty">You have not submitted any publication request yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
