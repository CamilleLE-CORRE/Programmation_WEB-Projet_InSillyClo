{% extends "core/base.html" %}
{% load static %}

{% block title %}Plasmid detail{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/plasmid.css' %}">
{% endblock %}

{% block content %}

<!-- Header -->
<div class="plasmid-header">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h1>{{ plasmid.identifier }}</h1>
        <a class="btn" href="{% url 'plasmids:plasmid_list' %}">
            Back to Plasmid List
        </a>
    </div>
</div>

<!-- Metadata -->
<div class="plasmid-metadata">
    <p><strong>Length:</strong> {{ parsed.length }} bp</p>
    <p><strong>Collection:</strong> {{ plasmid.collection }}</p>
</div>

<!-- <h2>Plasmid Visualization</h2> -->

<!-- SVG MAP -->
<div class="plasmid-map-container">

<svg
    class="plasmid-map"
    width="{{ visual_width }}"
    height="140"
    viewBox="0 0 {{ visual_width }} 140"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"
>

    <!-- Backbone ADN -->
    <line
        x1="0"
        y1="70"
        x2="{{ visual_width }}"
        y2="70"
        stroke="#444"
        stroke-width="4"
    />

    {% for feature in parsed.features %}

        {% if feature.linked_plasmid %}
            <a xlink:href="{% url 'plasmids:plasmid_detail' feature.linked_plasmid %}">
        {% endif %}

        <!-- Gene box -->
        <rect
            x="{{ feature.visual_left }}"
            y="45"
            width="{{ feature.visual_width }}"
            height="50"
            fill="{{ feature.color }}"
            stroke="#222"
            stroke-width="1.5"
            rx="4"
            ry="4"
            class="plasmid-feature"
        >
            <title>
                {{ feature.label }} ({{ feature.start }}..{{ feature.end }})
            </title>
        </rect>

        <!-- Gene label -->
        <text
            x="{{ feature.visual_left|add:feature.visual_width|floatformat:0 }}"
            y="75"
            text-anchor="middle"
            dominant-baseline="middle"
            font-size="12"
            fill="#fff"
            pointer-events="none"
        >
            {{ feature.label }}
        </text>


        <!-- Start position -->
        <!-- <text
            x="{{ feature.visual_left }}"
            y="110"
            text-anchor="start"
            font-size="10"
            fill="#333"
        >
            {{ feature.start }}
        </text> -->

        <!-- End position -->
        <!-- <text
            x="{{ feature.visual_left|add:feature.visual_width }}"
            y="110"
            text-anchor="end"
            font-size="10"
            fill="#333"
        >
            {{ feature.end }}
        </text> -->

        {% if feature.linked_plasmid %}
            </a>
        {% endif %}

    {% endfor %}

</svg>
</div>

<!-- Annotations table -->
<h2>Annotations</h2>

<table class="plasmid-table">
    <thead>
        <tr>
            <th>Label</th>
            <th>Type</th>
            <th>Location</th>
            <th>Length</th>
        </tr>
    </thead>
    <tbody>
        {% for feature in parsed.features %}
        <tr>
            <td>{{ feature.label }}</td>
            <td>{{ feature.type }}</td>
            <td>{{ feature.start }}..{{ feature.end }}</td>
            <td>{{ feature.length }} bp</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}
